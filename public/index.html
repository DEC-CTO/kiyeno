<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë²½ì²´ ì •ë³´ ê´€ë¦¬ ì‹œìŠ¤í…œ - Wall Management System</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- SheetJS ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- ExcelJS ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>

    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/breakdown-styles.css" />
    <link rel="stylesheet" href="css/material-management.css" />
    <link rel="stylesheet" href="css/material-selector.css" />
    <link rel="stylesheet" href="css/revit-responsive.css" />
    <link rel="stylesheet" href="css/wall-cost-results.css" />
    <link rel="stylesheet" href="css/display-system.css" />
    <link rel="stylesheet" href="css/logger-styles.css" />
    <link rel="stylesheet" href="css/price-comparison.css" />
    <link rel="stylesheet" href="css/order-form.css" />

    <!-- Dexie.js for IndexedDB management -->
    <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>

    <!-- Socket.IO Client for WebSocket communication -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    
    <!-- Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  </head>
  <body>
    <div class="container">
      <!-- ìƒë‹¨ ë©”ì¸ ì»¨í…ì¸  -->
      <div class="main-content">
        <!-- í—¤ë” -->
        <div class="header">
          <h1><i class="fas fa-building"></i> Kiyeno ë²½ì²´ ì •ë³´ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
        </div>

        <!-- í•„í„° ë° ê²€ìƒ‰ ì„¹ì…˜ ì œê±°ë¨ -->

        <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ë“¤ -->
        <div class="controls">
          <!-- ê²°ê³¼ë¬¼ ë””ìŠ¤í”Œë ˆì´ ì‹œìŠ¤í…œ -->
          <div class="display-mode-dropdown" style="display: none;">
            <button
              class="display-mode-button"
              id="displayModeButton"
              onclick="toggleDisplayModeDropdown()"
            >
              <i class="fas fa-list-alt"></i>
              ê¸°ë³¸ê°’ë³´ê¸°
              <i class="fas fa-chevron-down"></i>
            </button>
            <div class="display-mode-dropdown-menu" id="displayModeDropdown">
              <div
                class="display-mode-dropdown-item active"
                onclick="openDefaultViewModal(); toggleDisplayModeDropdown()"
              >
                <i class="fas fa-list-alt"></i>
                ê¸°ë³¸ê°’ë³´ê¸°
              </div>
              <div
                class="display-mode-dropdown-item"
                onclick="openTypeViewModal(); toggleDisplayModeDropdown()"
              >
                <i class="fas fa-layer-group"></i>
                íƒ€ì…ë³„ë³´ê¸°
              </div>
              <div
                class="display-mode-dropdown-item"
                onclick="openMaterialViewModal(); toggleDisplayModeDropdown()"
              >
                <i class="fas fa-box"></i>
                ì¬ë£Œë³„ë³´ê¸°
              </div>
              <div
                class="display-mode-dropdown-item"
                onclick="openWorkTypeViewModal(); toggleDisplayModeDropdown()"
              >
                <i class="fas fa-hard-hat"></i>
                ê³µì¢…ë³„ë³´ê¸°
              </div>
            </div>
          </div>

          <!-- ìì¬ ê´€ë¦¬ ë²„íŠ¼ -->
          <button
            class="btn btn-green"
            id="materialManageBtn"
            onclick="showMaterialManageModal()"
          >
            <i class="fas fa-tools"></i> ìì¬ ê´€ë¦¬
          </button>

          <!-- ë²½ì²´ íƒ€ì… ê´€ë¦¬ ë²„íŠ¼ -->
          <button
            class="btn btn-purple"
            id="wallTypeManageBtn"
            onclick="openRevitTypeMatching()"
          >
            <i class="fas fa-layer-group"></i> ë²½ì²´ íƒ€ì… ê´€ë¦¬
          </button>

          <!-- ì¼ìœ„ëŒ€ê°€ ê´€ë¦¬ ë²„íŠ¼ -->
          <button
            class="btn btn-orange"
            id="unitPriceManageBtn"
            onclick="openUnitPriceManagement()"
          >
            <i class="fas fa-calculator"></i> ì¼ìœ„ëŒ€ê°€ ê´€ë¦¬
          </button>

        </div>

        <!-- Revit ë°ì´í„° í™•ì¸ í…Œì´ë¸” (í•­ìƒ í‘œì‹œ) -->
        <div
          id="revitDataSection"
          class="revit-data-section"
        >
          <div class="revit-header">
            <h2><i class="fas fa-cube"></i> Revit ë²½ì²´ ë°ì´í„° í™•ì¸</h2>
          </div>

          <!-- íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°ë¥¼ ìœ„í•œ ìˆ¨ê²¨ì§„ input -->
          <input
            type="file"
            id="fileImportInput"
            accept=".json,.xlsx,.xls"
            style="display: none"
            onchange="handleFileImport(event)"
          />

          <div class="revit-table-wrapper">

            <!-- í•„í„° ì»¨íŠ¸ë¡¤ -->
            <div class="revit-filters">
              <div class="filter-group">
                <label for="nameFilter"
                  ><i class="fas fa-filter"></i> Name í•„í„°:</label
                >
                <select id="nameFilter" onchange="applyRevitFilters()">
                  <option value="">ì „ì²´</option>
                </select>
              </div>
              <div class="filter-group">
                <label for="levelFilter"
                  ><i class="fas fa-filter"></i> Level í•„í„°:</label
                >
                <select id="levelFilter" onchange="applyRevitFilters()">
                  <option value="">ì „ì²´</option>
                </select>
              </div>
              <div class="filter-group">
                <button
                  class="btn btn-sm btn-secondary"
                  onclick="clearRevitFilters()"
                >
                  <i class="fas fa-times"></i> í•„í„° ì´ˆê¸°í™”
                </button>
              </div>
              <!-- Revit ì—°ë™ ë©”ë‰´ -->
              <div class="filter-group">
                <div class="dropdown">
                  <button
                    class="btn btn-sm btn-purple dropdown-toggle"
                    onclick="toggleDropdown('revitIntegration')"
                  >
                    <i class="fas fa-cube"></i> Revit ì—°ë™
                    <i class="fas fa-chevron-down"></i>
                  </button>
                  <div class="dropdown-menu" id="revitIntegration">
                    <div
                      class="dropdown-item wall-selection-button"
                      onclick="selectSingleWallFromRevit()"
                    >
                      <i class="fas fa-mouse-pointer"></i> ë²½ì²´ ì„ íƒ (ë‹¨ì¼)
                    </div>
                    <div
                      class="dropdown-item wall-selection-button"
                      onclick="selectMultipleWallsFromRevit()"
                    >
                      <i class="fas fa-hand-pointer"></i> ë²½ì²´ ì„ íƒ (ë‹¤ì¤‘)
                    </div>
                    <div
                      class="dropdown-item wall-selection-button"
                      onclick="selectWallsByRoomFromRevit()"
                    >
                      <i class="fas fa-home"></i> ë£¸ìœ¼ë¡œ ë²½ì²´ì„ íƒ
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item" onclick="createWallTypesInRevit()">
                      <i class="fas fa-hammer"></i> WallType ìƒì„±
                    </div>
                  </div>
                </div>
              </div>
              <div class="filter-group">
                <div class="dropdown">
                  <button
                    class="btn btn-sm btn-primary dropdown-toggle"
                    type="button"
                    id="exportImportDropdown"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    <i class="fas fa-download"></i> ë°ì´í„° ê´€ë¦¬
                  </button>
                  <div class="dropdown-menu" aria-labelledby="exportImportDropdown">
                    <a class="dropdown-item" href="#" onclick="exportToExcel()">
                      <i class="fas fa-file-excel"></i> Excelë¡œ ë‚´ë³´ë‚´ê¸°
                    </a>
                    <a class="dropdown-item" href="#" onclick="exportToJSON()">
                      <i class="fas fa-file-code"></i> JSONìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°
                    </a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#" onclick="importFromFile()">
                      <i class="fas fa-upload"></i> íŒŒì¼ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
                    </a>
                  </div>
                </div>
              </div>
              <div class="filter-group">
                <button class="btn btn-sm btn-danger" onclick="clearRevitData()">
                  <i class="fas fa-trash"></i> ë°ì´í„° ì§€ìš°ê¸°
                </button>
              </div>
              <div class="filter-group">
                <button class="btn btn-sm btn-info" onclick="selectInRevit()">
                  <i class="fas fa-crosshairs"></i> Revit ê°ì²´ ì„ íƒ
                </button>
              </div>
              <div class="filter-group">
                <button class="btn btn-sm btn-success" onclick="calculateWallCosts()">
                  <i class="fas fa-calculator"></i> ê³„ì‚°í•˜ê¸°
                </button>
              </div>
            </div>

            <div class="revit-table-container">
              <table class="revit-table">
                <thead>
                  <tr>
                    <th class="col-select">
                      <input
                        type="checkbox"
                        id="revitSelectAll"
                        onchange="toggleAllRevitSelection()"
                      />
                    </th>
                    <th class="col-revit-id">Revit ID</th>
                    <th class="col-revit-name">Name</th>
                    <th class="col-revit-length">Length (m)</th>
                    <th class="col-revit-area">Area (mÂ²)</th>
                    <th class="col-revit-height">Height (m)</th>
                    <th class="col-revit-thickness">Thickness (m)</th>
                    <th class="col-revit-level">Level</th>
                    <th class="col-revit-category">Category</th>
                    <th class="col-revit-roomname">ì‹¤ëª… (Room)</th>
                  </tr>
                </thead>
                <tbody id="revitTableBody">
                  <!-- Revit ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

      </div>
      <!-- main-content ë‹«ê¸° -->

    </div>
    <!-- container ë‹«ê¸° -->

    <!-- ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ -->
    <div id="contextMenu" class="context-menu">
      <div class="context-menu-item" onclick="duplicateWall()">
        <i class="fas fa-copy"></i> ë²½ì²´ ë³µì‚¬
      </div>
      <div class="context-menu-item" onclick="deleteWall()">
        <i class="fas fa-trash-alt"></i> ë²½ì²´ ì‚­ì œ
      </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
    <div id="toast" class="toast">
      <div id="toastMessage"></div>
    </div>

    <!-- ì„ íƒ ì •ë³´ -->
    <div id="selectionInfo" class="selection-info">
      <span id="revitSelectionText"></span>
    </div>

    <!-- ì‹¤ëª… ì…ë ¥ ëª¨ë‹¬ -->
    <div id="roomNameModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-home"></i> ì‹¤ëª… ì…ë ¥</h3>
          <span class="close" onclick="closeRoomNameModal()">&times;</span>
        </div>
        <div class="modal-body">
          <p>ì„ íƒëœ ë²½ì²´ì˜ ì‹¤ëª…(ë£¸ ì´ë¦„)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:</p>
          <div class="wall-info" id="modalWallInfo">
            <!-- ë²½ì²´ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
          </div>
          <div class="input-group">
            <label for="roomNameInput">ì‹¤ëª…:</label>
            <input
              type="text"
              id="roomNameInput"
              placeholder="ì˜ˆ: ê±°ì‹¤, ì¹¨ì‹¤1, ì£¼ë°©..."
              maxlength="50"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeRoomNameModal()">
            <i class="fas fa-times"></i> ì·¨ì†Œ
          </button>
          <button class="btn btn-success" onclick="saveRoomName()">
            <i class="fas fa-save"></i> ì €ì¥
          </button>
        </div>
      </div>
    </div>

    <!-- Kiyeno ë²½ì²´ ê´€ë¦¬ ì‹œìŠ¤í…œ - í†µí•© ëª¨ë“ˆ -->
    <!-- ë¸Œë¦¿ì§€ ì‹œìŠ¤í…œ - ìƒˆë¡œìš´ ì‹œìŠ¤í…œê³¼ ê¸°ì¡´ ì‹œìŠ¤í…œ ì—°ê²° -->
    <script src="js/bridge.js"></script>
    <!-- ES6 ëª¨ë“ˆ ì‹œìŠ¤í…œ -->
    <script type="module" src="js/main.js"></script>
    <script type="module" src="js/modules/priceDatabase.js"></script>
    
    <!-- ë¶„ë¦¬ëœ ëª¨ë“ˆë“¤ (ê¸°ì¡´ app-services.js ë¶„ë¦¬) -->
    <script src="js/modules/materialManager.js"></script>
    <script src="js/modules/revitManager.js"></script>
    
    <!-- ë¶„ë¦¬ëœ ëª¨ë“ˆë“¤ (ê¸°ì¡´ revit-type-matching.js ë¶„ë¦¬) -->
    <script src="js/modules/revitUtilities.js"></script>
    <script src="js/modules/unitPriceManager.js"></script>
    <script src="js/modules/revitTypeMatching.js"></script>
    <script src="js/modules/priceComparisonManager.js"></script>
    
    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ íŒŒì¼ë“¤ -->
    <script src="js/app-core.js"></script>
    <script src="js/app-calculator.js"></script>
    <script src="js/app-services.js"></script>
    <script src="js/app-ui.js"></script>
    <script src="js/revit-wall-handler.js"></script>
    <script src="js/wall-cost-calculator.js"></script>
    <script src="js/display-system.js"></script>

    <!-- í†µí•© JavaScript ì´ˆê¸°í™” ì‹œìŠ¤í…œ -->
    <script>
      // ë°±ì—…ìš© í•¨ìˆ˜ ì •ì˜ (íŒŒì¼ì—ì„œ ë¡œë“œë˜ì§€ ì•Šì„ ê²½ìš°ë¥¼ ëŒ€ë¹„)
      if (typeof window.selectSingleWallFromRevit !== 'function') {
        window.selectSingleWallFromRevit = function () {
          console.log('ë°±ì—… selectSingleWallFromRevit í•¨ìˆ˜ í˜¸ì¶œë¨');
          if (window.chrome && window.chrome.webview) {
            const message = { action: 'selectWall' };
            window.chrome.webview.postMessage(JSON.stringify(message));
            if (typeof showToast === 'function') {
              showToast('ğŸ–±ï¸ Revitì—ì„œ ë²½ì²´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'info');
            } else {
              alert('Revitì—ì„œ ë²½ì²´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            }
          } else {
            alert(
              'Revit ì—°ë™ í™˜ê²½ì´ ì•„ë‹™ë‹ˆë‹¤. WebView2 í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.'
            );
          }
        };
      }

      if (typeof window.selectMultipleWallsFromRevit !== 'function') {
        window.selectMultipleWallsFromRevit = function () {
          console.log('ë°±ì—… selectMultipleWallsFromRevit í•¨ìˆ˜ í˜¸ì¶œë¨');
          if (window.chrome && window.chrome.webview) {
            const message = { action: 'selectMultipleWalls' };
            window.chrome.webview.postMessage(JSON.stringify(message));
            if (typeof showToast === 'function') {
              showToast(
                'ğŸ–±ï¸ Revitì—ì„œ ë²½ì²´ë“¤ì„ ì„ íƒí•´ì£¼ì„¸ìš”. (ì™„ë£Œí•˜ë ¤ë©´ Finish í´ë¦­)',
                'info'
              );
            } else {
              alert(
                'Revitì—ì„œ ë²½ì²´ë“¤ì„ ì„ íƒí•´ì£¼ì„¸ìš”. (ì™„ë£Œí•˜ë ¤ë©´ Finish í´ë¦­)'
              );
            }
          } else {
            alert(
              'Revit ì—°ë™ í™˜ê²½ì´ ì•„ë‹™ë‹ˆë‹¤. WebView2 í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.'
            );
          }
        };
      }

      if (typeof window.addWallsFromRevit !== 'function') {
        window.addWallsFromRevit = function (wallInfos) {
          console.log('ë°±ì—… addWallsFromRevit í•¨ìˆ˜ í˜¸ì¶œë¨', wallInfos);

          // ê¸°ë³¸ì ì¸ ë°ì´í„° í‘œì‹œ
          if (wallInfos && Array.isArray(wallInfos) && wallInfos.length > 0) {
            const revitSection = document.getElementById('revitDataSection');
            if (revitSection) {
              revitSection.style.display = 'flex';
              revitSection.scrollIntoView({ behavior: 'smooth' });
            }

            // ê°„ë‹¨í•œ í…Œì´ë¸” ë Œë”ë§
            const tableBody = document.getElementById('revitTableBody');
            if (tableBody) {
              tableBody.innerHTML = '';
              wallInfos.forEach((wall, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                              <td><input type="checkbox"></td>
                              <td>${wall.Id || wall.id || 'N/A'}</td>
                              <td>${wall.Name || wall.name || 'N/A'}</td>
                              <td>${
                                wall.WallType || wall.wallType || 'N/A'
                              }</td>
                              <td>${(wall.Area || wall.area || 0).toFixed(
                                3
                              )}</td>
                              <td>${(wall.Height || wall.height || 0).toFixed(
                                3
                              )}</td>
                              <td>${(wall.Length || wall.length || 0).toFixed(
                                3
                              )}</td>
                              <td>${(
                                wall.Thickness ||
                                wall.thickness ||
                                0
                              ).toFixed(3)}</td>
                              <td>${wall.Level || wall.level || 'N/A'}</td>
                              <td>${
                                wall.Material || wall.material || 'N/A'
                              }</td>
                              <td>${wall.Comments || wall.comments || '-'}</td>
                          `;
                tableBody.appendChild(row);
              });
            }

            const message = `Revitì—ì„œ ${wallInfos.length}ê°œ ë²½ì²´ ë°ì´í„°ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.`;
            if (typeof showToast === 'function') {
              showToast(message, 'success');
            } else {
              alert(message);
            }

            console.log('ë°›ì€ ë²½ì²´ ë°ì´í„°:', wallInfos);
          } else {
            alert('ìœ íš¨í•œ ë²½ì²´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
          }
        };
      }

      // ë°±ì—… í•¨ìˆ˜ë“¤ - ë©”ì¸ í•¨ìˆ˜ê°€ ì œëŒ€ë¡œ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
      console.log('HTML ë°±ì—… í•¨ìˆ˜ ì²´í¬ ì‹œì ì˜ í•¨ìˆ˜ ìƒíƒœ:', {
        calculateRevitTypeAreas: typeof window.calculateRevitTypeAreas,
        showRevitAreaSummary: typeof window.showRevitAreaSummary,
        clearRevitData: typeof window.clearRevitData,
        toggleAllRevitSelection: typeof window.toggleAllRevitSelection,
        toggleRevitSelection: typeof window.toggleRevitSelection,
      });

      // ë°±ì—… í•¨ìˆ˜ëŠ” ì§„ì§œë¡œ ë©”ì¸ í•¨ìˆ˜ê°€ ì—†ì„ ë•Œë§Œ ë“±ë¡
      setTimeout(() => {
        if (typeof window.calculateRevitTypeAreas !== 'function') {
          console.warn(
            'calculateRevitTypeAreas ë©”ì¸ í•¨ìˆ˜ ì—†ìŒ - ë°±ì—… í•¨ìˆ˜ ë“±ë¡'
          );
          window.calculateRevitTypeAreas = function () {
            console.log('ë°±ì—… calculateRevitTypeAreas í•¨ìˆ˜ í˜¸ì¶œë¨');
            alert(
              'Revit ë©´ì  ê³„ì‚° ê¸°ëŠ¥ì„ ë¡œë“œí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
            );
          };
        }

        if (typeof window.showRevitAreaSummary !== 'function') {
          console.warn('showRevitAreaSummary ë©”ì¸ í•¨ìˆ˜ ì—†ìŒ - ë°±ì—… í•¨ìˆ˜ ë“±ë¡');
          window.showRevitAreaSummary = function () {
            console.log('ë°±ì—… showRevitAreaSummary í•¨ìˆ˜ í˜¸ì¶œë¨');
            alert(
              'Revit ë©´ì  ìš”ì•½ ê¸°ëŠ¥ì„ ë¡œë“œí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
            );
          };
        }

        if (typeof window.clearRevitData !== 'function') {
          console.warn('clearRevitData ë©”ì¸ í•¨ìˆ˜ ì—†ìŒ - ë°±ì—… í•¨ìˆ˜ ë“±ë¡');
          window.clearRevitData = function () {
            console.log('ë°±ì—… clearRevitData í•¨ìˆ˜ í˜¸ì¶œë¨');
            if (confirm('Revit ë°ì´í„°ë¥¼ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
              const revitSection = document.getElementById('revitDataSection');
              if (revitSection) {
                revitSection.style.display = 'none';
              }
              const tableBody = document.getElementById('revitTableBody');
              if (tableBody) {
                tableBody.innerHTML =
                  '<tr><td colspan="11" style="text-align: center; padding: 20px;">Revit ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.</td></tr>';
              }
              alert('Revit ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
          };
        }

        if (typeof window.toggleAllRevitSelection !== 'function') {
          console.warn(
            'toggleAllRevitSelection ë©”ì¸ í•¨ìˆ˜ ì—†ìŒ - ë°±ì—… í•¨ìˆ˜ ë“±ë¡'
          );
          window.toggleAllRevitSelection = function () {
            console.log('ë°±ì—… toggleAllRevitSelection í•¨ìˆ˜ í˜¸ì¶œë¨');
            const checkboxes = document.querySelectorAll(
              '#revitTableBody input[type="checkbox"]'
            );
            const selectAll = document.getElementById('revitSelectAll');
            const isChecked = selectAll ? selectAll.checked : false;

            checkboxes.forEach((checkbox) => {
              checkbox.checked = isChecked;
            });
          };
        }

        if (typeof window.toggleRevitSelection !== 'function') {
          console.warn('toggleRevitSelection ë©”ì¸ í•¨ìˆ˜ ì—†ìŒ - ë°±ì—… í•¨ìˆ˜ ë“±ë¡');
          window.toggleRevitSelection = function (tempId, checked) {
            console.log(
              'ë°±ì—… toggleRevitSelection í•¨ìˆ˜ í˜¸ì¶œë¨',
              tempId,
              checked
            );
            // ê¸°ë³¸ì ì¸ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë³€ê²½ë§Œ ì²˜ë¦¬
          };
        }
      }, 50);

      // JavaScript íŒŒì¼ì—ì„œ í•¨ìˆ˜ë¥¼ ì§ì ‘ ê°€ì ¸ì™€ì„œ ê°•ì œ ë“±ë¡
      setTimeout(() => {
        console.log('ğŸ”§ HTMLì—ì„œ ë©”ì¸ í•¨ìˆ˜ ê°•ì œ ì°¾ê¸° ë° ë“±ë¡ ì‹œë„');

        // ëª¨ë“  ì „ì—­ ë³€ìˆ˜ì—ì„œ Revit í•¨ìˆ˜ë“¤ì„ ì°¾ì•„ì„œ ë“±ë¡
        try {
          // calculateRevitTypeAreas í•¨ìˆ˜ ì°¾ê¸°
          for (let key in window) {
            if (
              typeof window[key] === 'function' &&
              window[key].toString().includes('ğŸ§®')
            ) {
              console.log(
                'âœ… calculateRevitTypeAreas ë©”ì¸ í•¨ìˆ˜ ë°œê²¬, ê°•ì œ ë“±ë¡'
              );
              window.calculateRevitTypeAreas = window[key];
              break;
            }
          }

          // showRevitAreaSummary í•¨ìˆ˜ ì°¾ê¸°
          for (let key in window) {
            if (
              typeof window[key] === 'function' &&
              window[key].toString().includes('ğŸ“Š')
            ) {
              console.log('âœ… showRevitAreaSummary ë©”ì¸ í•¨ìˆ˜ ë°œê²¬, ê°•ì œ ë“±ë¡');
              window.showRevitAreaSummary = window[key];
              break;
            }
          }

          // ì§ì ‘ í•¨ìˆ˜ ì •ì˜ë¡œ ëŒ€ì²´ (ìµœí›„ ìˆ˜ë‹¨)
          if (
            !window.calculateRevitTypeAreas ||
            !window.calculateRevitTypeAreas.toString().includes('ğŸ§®')
          ) {
            console.log('ğŸ› ï¸ calculateRevitTypeAreas ë©”ì¸ í•¨ìˆ˜ ì§ì ‘ ì •ì˜');
            window.calculateRevitTypeAreas = function () {
              console.log('ğŸ§® HTML ì •ì˜ calculateRevitTypeAreas í•¨ìˆ˜ í˜¸ì¶œë¨');

              // ê¸°ë³¸ì ì¸ ë©´ì  ê³„ì‚° ë¡œì§
              const revitTableBody = document.getElementById('revitTableBody');
              if (!revitTableBody) {
                alert('Revit ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
              }

              const checkedRows = revitTableBody.querySelectorAll(
                'input[type="checkbox"]:checked'
              );
              if (checkedRows.length === 0) {
                alert('ë©´ì ì„ ê³„ì‚°í•  ë²½ì²´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
              }

              let totalArea = 0;
              let wallTypes = new Map();

              checkedRows.forEach((checkbox) => {
                const row = checkbox.closest('tr');
                const cells = row.querySelectorAll('td');
                if (cells.length >= 5) {
                  const wallType = cells[3].textContent.trim();
                  const area = parseFloat(cells[4].textContent) || 0;

                  if (wallTypes.has(wallType)) {
                    wallTypes.set(wallType, wallTypes.get(wallType) + area);
                  } else {
                    wallTypes.set(wallType, area);
                  }
                  totalArea += area;
                }
              });

              let message = `ì„ íƒëœ ${checkedRows.length}ê°œ ë²½ì²´ì˜ ë©´ì ì´ ê³„ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n`;
              wallTypes.forEach((area, type) => {
                message += `${type}: ${area.toFixed(3)}mÂ²\n`;
              });
              message += `\nì´ ë©´ì : ${totalArea.toFixed(3)}mÂ²`;

              alert(message);
            };
          }

          if (
            !window.showRevitAreaSummary ||
            !window.showRevitAreaSummary.toString().includes('ğŸ“Š')
          ) {
            console.log('ğŸ› ï¸ showRevitAreaSummary ë©”ì¸ í•¨ìˆ˜ ì§ì ‘ ì •ì˜');
            window.showRevitAreaSummary = function () {
              console.log('ğŸ“Š HTML ì •ì˜ showRevitAreaSummary í•¨ìˆ˜ í˜¸ì¶œë¨');

              const revitTableBody = document.getElementById('revitTableBody');
              if (!revitTableBody || revitTableBody.children.length === 0) {
                alert('Revit ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
              }

              let wallTypes = new Map();
              const rows = revitTableBody.querySelectorAll('tr');

              rows.forEach((row) => {
                const cells = row.querySelectorAll('td');
                if (cells.length >= 5) {
                  const wallType = cells[3].textContent.trim();
                  const area = parseFloat(cells[4].textContent) || 0;

                  if (wallTypes.has(wallType)) {
                    wallTypes.set(wallType, wallTypes.get(wallType) + area);
                  } else {
                    wallTypes.set(wallType, area);
                  }
                }
              });

              let summary = 'Revit ë²½ì²´ ë©´ì  ìš”ì•½:\n\n';
              let totalArea = 0;

              wallTypes.forEach((area, type) => {
                summary += `${type}: ${area.toFixed(3)}mÂ²\n`;
                totalArea += area;
              });

              summary += `\nì´ ${
                wallTypes.size
              }ê°œ íƒ€ì…, ì´ ë©´ì : ${totalArea.toFixed(3)}mÂ²`;
              alert(summary);
            };
          }
        } catch (error) {
          console.error('í•¨ìˆ˜ ë“±ë¡ ì¤‘ ì˜¤ë¥˜:', error);
        }

        console.log('âœ… HTML ë©”ì¸ í•¨ìˆ˜ ë“±ë¡ ì™„ë£Œ');

        // ë””ë²„ê¹…ìš© í•¨ìˆ˜ ì¶”ê°€
        window.testRevitFunctions = function () {
          console.log('ğŸ§ª HTML ë””ë²„ê¹… í•¨ìˆ˜ ì‹¤í–‰');
          console.log(
            'calculateRevitTypeAreas:',
            typeof window.calculateRevitTypeAreas
          );
          console.log(
            'showRevitAreaSummary:',
            typeof window.showRevitAreaSummary
          );

          // ê°•ì œë¡œ HTML í•¨ìˆ˜ ì¬ë“±ë¡
          window.calculateRevitTypeAreas = function () {
            console.log('ğŸ§® ê°•ì œ ë“±ë¡ëœ calculateRevitTypeAreas í˜¸ì¶œ');
            const revitTableBody = document.getElementById('revitTableBody');
            if (!revitTableBody) {
              alert('Revit ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
              return;
            }

            const checkedRows = revitTableBody.querySelectorAll(
              'input[type="checkbox"]:checked'
            );
            if (checkedRows.length === 0) {
              alert('ë©´ì ì„ ê³„ì‚°í•  ë²½ì²´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
              return;
            }

            alert(
              `${checkedRows.length}ê°œ ë²½ì²´ê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤. ë©´ì  ê³„ì‚° ê¸°ëŠ¥ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.`
            );
          };

          window.showRevitAreaSummary = function () {
            console.log('ğŸ“Š ê°•ì œ ë“±ë¡ëœ showRevitAreaSummary í˜¸ì¶œ');
            const revitTableBody = document.getElementById('revitTableBody');
            if (!revitTableBody || revitTableBody.children.length === 0) {
              alert('Revit ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
              return;
            }

            const rows = revitTableBody.querySelectorAll('tr');
            alert(
              `ì´ ${rows.length}ê°œì˜ Revit ë²½ì²´ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ë©´ì  ìš”ì•½ ê¸°ëŠ¥ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.`
            );
          };

          console.log('âœ… í•¨ìˆ˜ ê°•ì œ ì¬ë“±ë¡ ì™„ë£Œ');
        };
      }, 100);

      // =============================================================================
      // ìƒˆë¡œìš´ Revit ë©´ì  ê³„ì‚° ë° ìš”ì•½ í•¨ìˆ˜ë“¤
      // =============================================================================

      // ì„ íƒëœ Revit ë°ì´í„°ì˜ ë©´ì  ê³„ì‚° (ëª¨ë‹¬ì°½ìœ¼ë¡œ í‘œì‹œ)
      window.newCalculateRevitAreas = function () {
        console.log('ğŸ†• ìƒˆë¡œìš´ ì„ íƒ í•­ëª© ë©´ì  ê³„ì‚° í•¨ìˆ˜ í˜¸ì¶œë¨');

        const revitTableBody = document.getElementById('revitTableBody');
        if (!revitTableBody) {
          alert('Revit ë°ì´í„° í…Œì´ë¸”ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        const checkedRows = revitTableBody.querySelectorAll(
          'input[type="checkbox"]:checked'
        );
        if (checkedRows.length === 0) {
          alert('ë©´ì ì„ ê³„ì‚°í•  ë²½ì²´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }

        // ì„ íƒëœ ë²½ì²´ì˜ íƒ€ì…ë³„ ë©´ì  ê³„ì‚°
        const wallTypeAreas = new Map();
        let totalArea = 0;

        checkedRows.forEach((checkbox) => {
          const row = checkbox.closest('tr');
          const cells = row.querySelectorAll('td');
          if (cells.length >= 5) {
            const wallType = cells[3].textContent.trim();
            const area = parseFloat(cells[4].textContent) || 0;

            if (wallTypeAreas.has(wallType)) {
              wallTypeAreas.set(wallType, wallTypeAreas.get(wallType) + area);
            } else {
              wallTypeAreas.set(wallType, area);
            }
            totalArea += area;
          }
        });

        // ëª¨ë‹¬ì°½ í‘œì‹œ
        showAreaCalculationModal(
          wallTypeAreas,
          `ì„ íƒëœ ${checkedRows.length}ê°œ ë²½ì²´`,
          totalArea,
          true
        );
      };

      // ì „ì²´ Revit ë°ì´í„°ì˜ ë©´ì  ìš”ì•½ (ëª¨ë‹¬ì°½ìœ¼ë¡œ í‘œì‹œ)
      window.newShowRevitSummary = function () {
        console.log('ğŸ†• ìƒˆë¡œìš´ ë©´ì  ìš”ì•½ í•¨ìˆ˜ í˜¸ì¶œë¨');

        const revitTableBody = document.getElementById('revitTableBody');
        if (!revitTableBody) {
          alert('Revit ë°ì´í„° í…Œì´ë¸”ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        const rows = revitTableBody.querySelectorAll('tr');
        if (rows.length === 0) {
          alert('Revit ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        // ì „ì²´ ë²½ì²´ì˜ íƒ€ì…ë³„ ë©´ì  ê³„ì‚°
        const wallTypeAreas = new Map();
        let totalArea = 0;
        let totalCount = 0;

        rows.forEach((row) => {
          const cells = row.querySelectorAll('td');
          if (cells.length >= 5 && cells[1].textContent.trim() !== 'N/A') {
            const wallType = cells[3].textContent.trim();
            const area = parseFloat(cells[4].textContent) || 0;

            if (wallTypeAreas.has(wallType)) {
              wallTypeAreas.set(wallType, wallTypeAreas.get(wallType) + area);
            } else {
              wallTypeAreas.set(wallType, area);
            }
            totalArea += area;
            totalCount++;
          }
        });

        // ëª¨ë‹¬ì°½ í‘œì‹œ
        showAreaCalculationModal(
          wallTypeAreas,
          `ì „ì²´ ${totalCount}ê°œ ë²½ì²´`,
          totalArea,
          false
        );
      };

      // ë©´ì  ê³„ì‚° ê²°ê³¼ë¥¼ ëª¨ë‹¬ì°½ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
      function showAreaCalculationModal(
        wallTypeAreas,
        title,
        totalArea,
        isSelectedOnly
      ) {
        if (wallTypeAreas.size === 0) {
          alert('ê³„ì‚°í•  ë©´ì  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        // ëª¨ë‹¬ HTML ìƒì„±
        let modalHTML = `
              <div style="text-align: left; line-height: 1.6; max-width: 600px;">
                  <h3 style="color: #8b5cf6; margin-bottom: 15px; text-align: center;">
                      <i class="fas fa-calculator"></i> ${title} ë©´ì  ê³„ì‚° ê²°ê³¼
                  </h3>

                  <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                      <h4 style="margin: 0 0 10px 0; color: #333;">ğŸ“Š íƒ€ì…ë³„ ë©´ì  ì •ë³´</h4>
                      <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                          <thead>
                              <tr style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white;">
                                  <th style="border: 1px solid #5b21b6; padding: 10px; text-align: left;">WallType</th>
                                  <th style="border: 1px solid #5b21b6; padding: 10px; text-align: right;">ë©´ì  (mÂ²)</th>
                                  <th style="border: 1px solid #5b21b6; padding: 10px; text-align: right;">ë¹„ìœ¨ (%)</th>
                              </tr>
                          </thead>
                          <tbody>
          `;

        // ë©´ì ë³„ë¡œ ì •ë ¬
        const sortedTypes = Array.from(wallTypeAreas.entries()).sort(
          (a, b) => b[1] - a[1]
        );

        sortedTypes.forEach(([wallType, area], index) => {
          const percentage = totalArea > 0 ? (area / totalArea) * 100 : 0;
          const rowClass = index % 2 === 0 ? '#ffffff' : '#f8f9fa';

          modalHTML += `
                  <tr style="background: ${rowClass};">
                      <td style="border: 1px solid #ddd; padding: 10px; font-weight: 600; color: #8b5cf6;">${wallType}</td>
                      <td style="border: 1px solid #ddd; padding: 10px; text-align: right; font-weight: 600; color: #0066cc;">${area.toFixed(
                        3
                      )}</td>
                      <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">${percentage.toFixed(
                        1
                      )}%</td>
                  </tr>
              `;
        });

        modalHTML += `
                          </tbody>
                          <tfoot>
                              <tr style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); font-weight: bold;">
                                  <td style="border: 1px solid #ddd; padding: 10px; color: #1976d2;">ì´ê³„ (${
                                    wallTypeAreas.size
                                  }ê°œ íƒ€ì…)</td>
                                  <td style="border: 1px solid #ddd; padding: 10px; text-align: right; color: #d32f2f; font-size: 16px;">${totalArea.toFixed(
                                    3
                                  )}</td>
                                  <td style="border: 1px solid #ddd; padding: 10px; text-align: right; color: #1976d2;">100.0%</td>
                              </tr>
                          </tfoot>
                      </table>
                  </div>

                  <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #4caf50;">
                      <h4 style="margin: 0 0 10px 0; color: #2e7d32;">ğŸ¯ ë©”ì¸ í…Œì´ë¸” ì ìš© ì˜µì…˜</h4>
                      <p style="margin: 0 0 10px 0; color: #555;">
                          ê³„ì‚°ëœ ë©´ì ì„ ìƒë‹¨ ë©”ì¸ í…Œì´ë¸”ì˜ <strong>mÂ²</strong> ì»¬ëŸ¼ì— ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                      </p>
                      <div style="background: white; padding: 10px; border-radius: 5px; font-size: 12px; color: #666;">
                          â„¹ï¸ ì ìš© ì‹œ ê°™ì€ WallTypeì˜ ì²« ë²ˆì§¸ í–‰ì—ë§Œ ë©´ì ì´ í‘œì‹œë˜ê³ , ë‚˜ë¨¸ì§€ ë™ì¼ íƒ€ì… í–‰ì€ ë¹ˆ ê°’ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.
                      </div>
                  </div>

                  <div style="text-align: center; margin-top: 20px;">
                      <button id="btn-apply-areas" style="padding: 12px 24px; margin-right: 10px; background: #4caf50; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                          <i class="fas fa-check"></i> ë©”ì¸ í…Œì´ë¸”ì— ì ìš©
                      </button>
                      <button id="btn-copy-data" style="padding: 12px 24px; margin-right: 10px; background: #2196f3; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                          <i class="fas fa-copy"></i> ë°ì´í„° ë³µì‚¬
                      </button>
                      <button id="btn-close-modal" style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                          <i class="fas fa-times"></i> ë‹«ê¸°
                      </button>
                  </div>
              </div>
          `;

        // ëª¨ë‹¬ ìƒì„± ë° í‘œì‹œ
        const modal = document.createElement('div');
        modal.style.cssText = `
              position: fixed; top: 0; left: 0; width: 100%; height: 100%;
              background: rgba(0,0,0,0.6); z-index: 3000; display: flex;
              align-items: center; justify-content: center; backdrop-filter: blur(2px);
          `;

        const dialog = document.createElement('div');
        dialog.style.cssText = `
              background: white; padding: 25px; border-radius: 12px;
              max-width: 700px; width: 90%; box-shadow: 0 20px 40px rgba(0,0,0,0.3);
              max-height: 90vh; overflow-y: auto; animation: fadeInScale 0.3s ease-out;
          `;

        // CSS ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
        if (!document.getElementById('modal-animations')) {
          const style = document.createElement('style');
          style.id = 'modal-animations';
          style.textContent = `
                  @keyframes fadeInScale {
                      from { opacity: 0; transform: scale(0.9); }
                      to { opacity: 1; transform: scale(1); }
                  }
              `;
          document.head.appendChild(style);
        }

        dialog.innerHTML = modalHTML;
        modal.appendChild(dialog);
        document.body.appendChild(modal);

        // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        dialog.querySelector('#btn-apply-areas').onclick = () => {
          // ğŸ”§ ìˆ˜ì •: wallDataë¥¼ ì‹¤ì œë¡œ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜ ì‚¬ìš©
          if (typeof window.applyRevitAreasToMain === 'function') {
            window.applyRevitAreasToMain(wallTypeAreas);
            console.log('âœ… applyRevitAreasToMain í•¨ìˆ˜ í˜¸ì¶œ ì™„ë£Œ');
          } else {
            // í´ë°±: UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ì‚¬ìš©
            console.warn(
              'âš ï¸ applyRevitAreasToMain í•¨ìˆ˜ê°€ ì—†ì–´ì„œ UI ì—…ë°ì´íŠ¸ë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤.'
            );
            applyAreasToMainTable(wallTypeAreas);
          }
          modal.remove();
        };

        dialog.querySelector('#btn-copy-data').onclick = () => {
          copyAreaDataToClipboard(wallTypeAreas, totalArea);
        };

        dialog.querySelector('#btn-close-modal').onclick = () => {
          modal.remove();
        };

        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ì‹œ ë‹«ê¸°
        modal.addEventListener('click', function (e) {
          if (e.target === modal) {
            modal.remove();
          }
        });

        // ESC í‚¤ë¡œ ë‹«ê¸°
        document.addEventListener('keydown', function escHandler(e) {
          if (e.key === 'Escape') {
            modal.remove();
            document.removeEventListener('keydown', escHandler);
          }
        });
      }

      // ê³„ì‚°ëœ ë©´ì ì„ ë©”ì¸ í…Œì´ë¸”ì— ì ìš©í•˜ëŠ” í•¨ìˆ˜ (ì™„ì „ ìƒˆ ë²„ì „)
      function applyAreasToMainTable(wallTypeAreas) {
        console.log('ğŸ“Š ìƒˆë¡œìš´ ë©´ì  ì ìš© í•¨ìˆ˜ ì‹œì‘');
        console.log('ì ìš©í•  ë©´ì  ë°ì´í„°:', wallTypeAreas);

        // 1ë‹¨ê³„: wallDataì—ì„œ ì§ì ‘ ì—…ë°ì´íŠ¸
        let updatedCount = 0;
        const processedTypes = new Set();

        if (typeof wallData !== 'undefined' && Array.isArray(wallData)) {
          wallData.forEach((wall, index) => {
            console.log(
              `ğŸ” ë²½ì²´ ${index}: wallType="${
                wall.wallType
              }", has()=${wallTypeAreas.has(wall.wallType)}`
            );

            if (wall.wallType && wallTypeAreas.has(wall.wallType)) {
              if (!processedTypes.has(wall.wallType)) {
                // ì²« ë²ˆì§¸ ë²½ì²´ì—ë§Œ ë©´ì  ì ìš©
                const area = wallTypeAreas.get(wall.wallType);
                wall.calculatedTotalArea = area;
                processedTypes.add(wall.wallType);
                updatedCount++;
                console.log(
                  `âœ… ${wall.wallType}: ${area}mÂ² ì ìš© (wallData ì§ì ‘ ì—…ë°ì´íŠ¸)`
                );
              } else {
                // ë™ì¼í•œ íƒ€ì…ì˜ ë‹¤ë¥¸ ë²½ì²´ë“¤ì€ ë¹ˆ ê°’
                wall.calculatedTotalArea = '';
                console.log(`ğŸ”„ ${wall.wallType}: ì¶”ê°€ í–‰ì€ ë¹ˆ ê°’ìœ¼ë¡œ ì„¤ì •`);
              }
            } else {
              console.log(
                `âŒ ë§¤ì¹­ ì‹¤íŒ¨: wallType="${
                  wall.wallType
                }" (íƒ€ì…: ${typeof wall.wallType})`
              );
            }
          });
        } else {
          console.error(
            'âŒ wallDataê°€ ì—†ê±°ë‚˜ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:',
            typeof wallData
          );
          console.error(
            'window.wallData í™•ì¸:',
            typeof window.wallData,
            Array.isArray(window.wallData)
          );
          // ëŒ€ì•ˆ: window.wallData ì‚¬ìš© ì‹œë„
          if (window.wallData && Array.isArray(window.wallData)) {
            console.log('ğŸ”„ window.wallDataë¡œ ì¬ì‹œë„í•©ë‹ˆë‹¤');
            window.wallData.forEach((wall, index) => {
              console.log(
                `ğŸ” ë²½ì²´ ${index}: wallType="${
                  wall.wallType
                }", has()=${wallTypeAreas.has(wall.wallType)}`
              );

              if (wall.wallType && wallTypeAreas.has(wall.wallType)) {
                if (!processedTypes.has(wall.wallType)) {
                  const area = wallTypeAreas.get(wall.wallType);
                  wall.calculatedTotalArea = area;
                  processedTypes.add(wall.wallType);
                  updatedCount++;
                  console.log(
                    `âœ… ${wall.wallType}: ${area}mÂ² ì ìš© (window.wallData ì‚¬ìš©)`
                  );
                } else {
                  wall.calculatedTotalArea = '';
                  console.log(`ğŸ”„ ${wall.wallType}: ì¶”ê°€ í–‰ì€ ë¹ˆ ê°’ìœ¼ë¡œ ì„¤ì •`);
                }
              }
            });
          }
        }

        // 2ë‹¨ê³„: ë°ì´í„° ì €ì¥
        if (updatedCount > 0) {
          // ë°ì´í„° ë³€ê²½ í‘œì‹œ
          if (typeof window.markDataAsModified === 'function') {
            window.markDataAsModified();
            console.log('ğŸ“ ë°ì´í„° ë³€ê²½ í”Œë˜ê·¸ ì„¤ì •');
          }

          // localStorage ì €ì¥
          if (typeof window.saveToLocalStorage === 'function') {
            window.saveToLocalStorage();
            console.log('ğŸ’¾ localStorage ì €ì¥ ì™„ë£Œ');
          }

          // 3ë‹¨ê³„: UI ì—…ë°ì´íŠ¸
          if (typeof window.renderTable === 'function') {
            window.renderTable();
            console.log('ğŸ”„ í…Œì´ë¸” ì¬ë Œë”ë§ ì™„ë£Œ');
          }

          alert(
            `âœ… ${updatedCount}ê°œ WallTypeì˜ ë©´ì ì´ ì ìš©ë˜ê³  ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`
          );
        } else {
          alert('âŒ ì ìš©í•  ìˆ˜ ìˆëŠ” WallTypeì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      }

      // ë©´ì  ë°ì´í„°ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í•˜ëŠ” í•¨ìˆ˜
      function copyAreaDataToClipboard(wallTypeAreas, totalArea) {
        let copyText = 'WallTypeë³„ ë©´ì  ì •ë³´\\n\\n';

        wallTypeAreas.forEach((area, wallType) => {
          copyText += `${wallType}: ${area.toFixed(3)}mÂ²\\n`;
        });

        copyText += `\\nì´ ë©´ì : ${totalArea.toFixed(3)}mÂ²`;

        navigator.clipboard
          .writeText(copyText)
          .then(() => {
            alert('ğŸ“‹ ë©´ì  ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
          })
          .catch(() => {
            // fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = copyText;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('ğŸ“‹ ë©´ì  ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
          });
      }

      console.log('HTML ë°±ì—… í•¨ìˆ˜ ì •ì˜ ì™„ë£Œ:', {
        selectSingleWallFromRevit: typeof window.selectSingleWallFromRevit,
        selectMultipleWallsFromRevit:
          typeof window.selectMultipleWallsFromRevit,
        addWallsFromRevit: typeof window.addWallsFromRevit,
        calculateRevitTypeAreas: typeof window.calculateRevitTypeAreas,
        showRevitAreaSummary: typeof window.showRevitAreaSummary,
        clearRevitData: typeof window.clearRevitData,
        toggleAllRevitSelection: typeof window.toggleAllRevitSelection,
        toggleRevitSelection: typeof window.toggleRevitSelection,
      });
    </script>
    <!-- í•˜ë‹¨ ìŠ¬ë¼ì´ë“œ íŒ¨ë„ (ê³„ì‚° ê²°ê³¼) -->
    <div id="wallCostResultsPanel" class="wall-cost-results-panel">
      <div class="panel-header">
        <div class="panel-title">
          <i class="fas fa-calculator"></i>
          <span>ë²½ì²´ ê³„ì‚° ê²°ê³¼</span>
          <span id="calculationSummary" class="calculation-summary"></span>
        </div>
        <div class="panel-controls">
          <button class="btn btn-sm btn-secondary" onclick="toggleResultsPanel()">
            <i class="fas fa-chevron-down" id="panelToggleIcon"></i>
          </button>
          <div class="dropdown" style="position: relative; display: inline-block;">
            <button class="btn btn-sm btn-primary" onclick="toggleExportDropdown(event)">
              <i class="fas fa-download"></i> Excel ë‚´ë³´ë‚´ê¸° <i class="fas fa-caret-down"></i>
            </button>
            <div id="exportDropdown" class="dropdown-menu" style="display: none;">
              <a class="dropdown-item" onclick="exportCalculationResults()">
                <i class="fas fa-file-excel"></i> ë²½ì²´ ê³„ì‚° ê²°ê³¼ (4ê°œ ì‹œíŠ¸)
              </a>
              <a class="dropdown-item" onclick="exportOrderForm()">
                <i class="fas fa-clipboard-list"></i> ë°œì£¼ì„œ
              </a>
              <a class="dropdown-item" onclick="exportPriceComparisonToExcel()">
                <i class="fas fa-chart-bar"></i> ë‹¨ê°€ë¹„êµí‘œ
              </a>
              <a class="dropdown-item" onclick="exportEstimate()">
                <i class="fas fa-file-invoice"></i> ê²¬ì ì„œ
              </a>
            </div>
          </div>
          <button class="btn btn-sm btn-danger" onclick="closeResultsPanel()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      
      <div class="panel-content">
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="panel-tabs">
          <button class="panel-tab active" onclick="switchResultTab('comparison')">
            <i class="fas fa-balance-scale"></i> ë²½ì²´ë³„ í•©ê³„
          </button>
          <button class="panel-tab" onclick="switchResultTab('individual')">
            <i class="fas fa-list"></i> ë²½ì²´ë³„ ìƒì„¸
          </button>
          <button class="panel-tab" onclick="switchResultTab('summary')">
            <i class="fas fa-chart-pie"></i> ì§‘ê³„ í˜„í™©
          </button>
          <button class="panel-tab" onclick="switchResultTab('orderForm')">
            <i class="fas fa-clipboard-list"></i> ë°œì£¼ì„œ
          </button>
          <button class="panel-tab" onclick="switchResultTab('priceComparison')">
            <i class="fas fa-chart-bar"></i> ë‹¨ê°€ë¹„êµí‘œ
          </button>
          <button class="panel-tab" onclick="switchResultTab('estimate')">
            <i class="fas fa-file-invoice"></i> ê²¬ì ì„œ
          </button>
        </div>
        
        <!-- ë²½ì²´ë³„ í•©ê³„ íƒ­ -->
        <div id="comparisonTab" class="tab-content active">
          <div class="comparison-container">
            <div class="comparison-table-container">
              <table class="comparison-table">
                <thead>
                  <tr>
                    <th>ë²½ì²´ëª…</th>
                    <th>ê°œìˆ˜</th>
                    <th>ë‹¨ìœ„</th>
                    <th>ìˆ˜ëŸ‰</th>
                    <th>ìì¬ë¹„</th>
                    <th>ë…¸ë¬´ë¹„</th>
                    <th>ë‹¨ê°€</th>
                    <th>ì´í•©ê³„</th>
                  </tr>
                </thead>
                <tbody id="comparisonTableBody">
                  <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ë²½ì²´ë³„ ìƒì„¸ íƒ­ -->
        <div id="individualTab" class="tab-content">
          <div class="wall-results-container">
            <!-- ë²½ì²´ë³„ ê³„ì‚° ê²°ê³¼ ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
          </div>
        </div>

        <!-- ì§‘ê³„ í˜„í™© íƒ­ -->
        <div id="summaryTab" class="tab-content">
          <div class="summary-dashboard">
            <div class="summary-cards">
              <div class="summary-card">
                <h4>ì´ ë©´ì </h4>
                <div class="summary-value" id="totalArea">0 mÂ²</div>
              </div>
              <div class="summary-card">
                <h4>ì´ ì¬ë£Œë¹„</h4>
                <div class="summary-value" id="totalMaterialCost">â‚©0</div>
              </div>
              <div class="summary-card">
                <h4>ì´ ë…¸ë¬´ë¹„</h4>
                <div class="summary-value" id="totalLaborCost">â‚©0</div>
              </div>
              <div class="summary-card">
                <h4>ì´ ê³µì‚¬ë¹„</h4>
                <div class="summary-value" id="totalProjectCost">â‚©0</div>
              </div>
            </div>

            <div class="summary-charts">
              <div class="chart-container">
                <h4>ê³µì¢…ë³„ ë¹„ìš© ë¶„í¬</h4>
                <canvas id="workTypeChart"></canvas>
              </div>
              <div class="chart-container">
                <h4>ë²½ì²´ íƒ€ì…ë³„ ë¹„êµ</h4>
                <canvas id="wallTypeChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- ë°œì£¼ì„œ íƒ­ -->
        <div id="orderFormTab" class="tab-content">
          <div id="orderFormContainer">
            <!-- ë°œì£¼ì„œ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤ -->
          </div>
        </div>

        <!-- ë‹¨ê°€ë¹„êµí‘œ íƒ­ -->
        <div id="priceComparisonTab" class="tab-content">
          <div id="priceComparisonContainer">
            <!-- ë‹¨ê°€ë¹„êµí‘œ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤ -->
          </div>
        </div>

        <!-- ê²¬ì ì„œ íƒ­ -->
        <div id="estimateTab" class="tab-content">
          <div id="estimateContainer">
            <div style="padding: 40px; text-align: center; color: #6c757d;">
              <i class="fas fa-file-invoice" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
              <p style="font-size: 18px; margin-bottom: 10px;">ê²¬ì ì„œ ê¸°ëŠ¥</p>
              <p style="font-size: 14px;">ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- íŒ¨ë„ ë°°ê²½ ì˜¤ë²„ë ˆì´ -->
    <div id="panelOverlay" class="panel-overlay"></div>

    <!-- ê¸°ë³¸ê°’ë³´ê¸° ëª¨ë‹¬ -->
    <div id="defaultViewModal" class="modal-overlay" style="display: none;">
      <div class="modal-container large-modal">
        <div class="modal-header">
          <h2><i class="fas fa-list-alt"></i> ê¸°ë³¸ê°’ë³´ê¸°</h2>
          <button class="modal-close-btn" onclick="closeDefaultViewModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-content">
          <div class="display-table-container">
            <div class="display-table-scroll">
              <table class="display-table default-view">
                <thead>
                  <tr>
                    <th rowspan="3">NO</th>
                    <th rowspan="3">ì‹¤</th>
                    <th rowspan="3">ë¶€ìœ„</th>
                    <th rowspan="3">ê³µì¢…</th>
                    <th rowspan="3">í’ˆëª…</th>
                    <th rowspan="3">ê·œê²©</th>
                    <th rowspan="3">ë‹¨ìœ„</th>
                    <th rowspan="3">ìˆ˜ëŸ‰</th>
                    <th colspan="6">ë„ê¸‰</th>
                    <th colspan="6">ì‹¤í–‰</th>
                  </tr>
                  <tr>
                    <th colspan="2">ìì¬ë¹„</th>
                    <th colspan="2">ë…¸ë¬´ë¹„</th>
                    <th colspan="2">í•©ê³„</th>
                    <th colspan="2">ìì¬ë¹„</th>
                    <th colspan="2">ë…¸ë¬´ë¹„</th>
                    <th colspan="2">í•©ê³„</th>
                  </tr>
                  <tr>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="20" style="text-align: center; padding: 40px; color: #666;">
                      ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì¼ìœ„ëŒ€ê°€ ê´€ë¦¬ì—ì„œ ì„¸ë¶€ì•„ì´í…œì„ ìƒì„±í•´ì£¼ì„¸ìš”.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- íƒ€ì…ë³„ë³´ê¸° ëª¨ë‹¬ -->
    <div id="typeViewModal" class="modal-overlay" style="display: none;">
      <div class="modal-container large-modal">
        <div class="modal-header">
          <h2><i class="fas fa-layer-group"></i> íƒ€ì…ë³„ë³´ê¸°</h2>
          <button class="modal-close-btn" onclick="closeTypeViewModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-content">
          <div class="display-table-container">
            <div class="display-table-scroll">
              <table class="display-table type-view">
                <thead>
                  <tr>
                    <th rowspan="3">TYPE</th>
                    <th rowspan="3">í’ˆëª…</th>
                    <th rowspan="3">ê·œê²©</th>
                    <th rowspan="3">ë‹¨ìœ„</th>
                    <th rowspan="3">ìˆ˜ëŸ‰</th>
                    <th colspan="6">ë„ê¸‰</th>
                    <th colspan="6">ì‹¤í–‰</th>
                  </tr>
                  <tr>
                    <th colspan="2">ìì¬</th>
                    <th colspan="2">ë…¸ë¬´</th>
                    <th colspan="2">í•©ê³„</th>
                    <th colspan="2">ìì¬</th>
                    <th colspan="2">ë…¸ë¬´</th>
                    <th colspan="2">í•©ê³„</th>
                  </tr>
                  <tr>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="17" style="text-align: center; padding: 40px; color: white;">
                      ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì¼ìœ„ëŒ€ê°€ ê´€ë¦¬ì—ì„œ ì„¸ë¶€ì•„ì´í…œì„ ìƒì„±í•´ì£¼ì„¸ìš”.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ì¬ë£Œë³„ë³´ê¸° ëª¨ë‹¬ -->
    <div id="materialViewModal" class="modal-overlay" style="display: none;">
      <div class="modal-container large-modal">
        <div class="modal-header">
          <h2><i class="fas fa-tools"></i> ì¬ë£Œë³„ë³´ê¸°</h2>
          <button class="modal-close-btn" onclick="closeMaterialViewModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-content">
          <div class="display-table-container">
            <div class="display-table-scroll">
              <table class="display-table material-view">
                <thead>
                  <tr>
                    <th rowspan="3">ë¶€ìœ„</th>
                    <th rowspan="3">í’ˆëª…</th>
                    <th rowspan="3">ê·œê²©</th>
                    <th rowspan="3">SPEC</th>
                    <th rowspan="3">ë‹¨ìœ„</th>
                    <th rowspan="3">ìˆ˜ëŸ‰</th>
                    <th colspan="2">ë°œì£¼ìˆ˜ëŸ‰</th>
                    <th colspan="6">ë„ê¸‰</th>
                    <th colspan="6">ì‹¤í–‰</th>
                  </tr>
                  <tr>
                    <th rowspan="2">ë‹¨ìœ„</th>
                    <th rowspan="2">ìˆ˜ëŸ‰</th>
                    <th colspan="2">ìì¬ë¹„</th>
                    <th colspan="2">ë…¸ë¬´ë¹„</th>
                    <th colspan="2">í•©ê³„</th>
                    <th colspan="2">ìì¬ë¹„</th>
                    <th colspan="2">ë…¸ë¬´ë¹„</th>
                    <th colspan="2">í•©ê³„</th>
                  </tr>
                  <tr>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="20" style="text-align: center; padding: 40px; color: white;">
                      ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì¼ìœ„ëŒ€ê°€ ê´€ë¦¬ì—ì„œ ì„¸ë¶€ì•„ì´í…œì„ ìƒì„±í•´ì£¼ì„¸ìš”.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ê³µì¢…ë³„ë³´ê¸° ëª¨ë‹¬ -->
    <div id="workTypeViewModal" class="modal-overlay" style="display: none;">
      <div class="modal-container large-modal">
        <div class="modal-header">
          <h2><i class="fas fa-hard-hat"></i> ê³µì¢…ë³„ë³´ê¸°</h2>
          <button class="modal-close-btn" onclick="closeWorkTypeViewModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-content">
          <div class="display-table-container">
            <div class="display-table-scroll">
              <table class="display-table work-type-view">
                <thead>
                  <tr>
                    <th rowspan="3">ê³µì¢…</th>
                    <th rowspan="3">ë¶€ìœ„</th>
                    <th rowspan="3">í’ˆëª…</th>
                    <th rowspan="3">ê·œê²©</th>
                    <th rowspan="3">ë‹¨ìœ„</th>
                    <th rowspan="3">ìˆ˜ëŸ‰</th>
                    <th colspan="6">ë„ê¸‰</th>
                    <th colspan="6">ì‹¤í–‰</th>
                  </tr>
                  <tr>
                    <th colspan="2">ìì¬ë¹„</th>
                    <th colspan="2">ë…¸ë¬´ë¹„</th>
                    <th colspan="2">í•©ê³„</th>
                    <th colspan="2">ìì¬ë¹„</th>
                    <th colspan="2">ë…¸ë¬´ë¹„</th>
                    <th colspan="2">í•©ê³„</th>
                  </tr>
                  <tr>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë‹¨ê°€</th>
                    <th>ê¸ˆì•¡</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="18" style="text-align: center; padding: 40px; color: white;">
                      ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì¼ìœ„ëŒ€ê°€ ê´€ë¦¬ì—ì„œ ì„¸ë¶€ì•„ì´í…œì„ ìƒì„±í•´ì£¼ì„¸ìš”.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ëª¨ë‹¬ ê´€ë ¨ JavaScript -->
    <script>
      // ê¸°ë³¸ê°’ë³´ê¸° ëª¨ë‹¬ ì—´ê¸°
      function openDefaultViewModal() {
        document.getElementById('defaultViewModal').style.display = 'flex';
        document.body.style.overflow = 'hidden'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
      }

      // ê¸°ë³¸ê°’ë³´ê¸° ëª¨ë‹¬ ë‹«ê¸°
      function closeDefaultViewModal() {
        document.getElementById('defaultViewModal').style.display = 'none';
        document.body.style.overflow = 'auto'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë³µì›
      }

      // íƒ€ì…ë³„ë³´ê¸° ëª¨ë‹¬ ì—´ê¸°
      function openTypeViewModal() {
        document.getElementById('typeViewModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
      // íƒ€ì…ë³„ë³´ê¸° ëª¨ë‹¬ ë‹«ê¸°
      function closeTypeViewModal() {
        document.getElementById('typeViewModal').style.display = 'none';
        document.body.style.overflow = 'auto';
      }

      // ì¬ë£Œë³„ë³´ê¸° ëª¨ë‹¬ ì—´ê¸°
      function openMaterialViewModal() {
        document.getElementById('materialViewModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
      // ì¬ë£Œë³„ë³´ê¸° ëª¨ë‹¬ ë‹«ê¸°
      function closeMaterialViewModal() {
        document.getElementById('materialViewModal').style.display = 'none';
        document.body.style.overflow = 'auto';
      }

      // ê³µì¢…ë³„ë³´ê¸° ëª¨ë‹¬ ì—´ê¸°
      function openWorkTypeViewModal() {
        document.getElementById('workTypeViewModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
      // ê³µì¢…ë³„ë³´ê¸° ëª¨ë‹¬ ë‹«ê¸°
      function closeWorkTypeViewModal() {
        document.getElementById('workTypeViewModal').style.display = 'none';
        document.body.style.overflow = 'auto';
      }

      // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
      document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('defaultViewModal');
        if (modal) {
          modal.addEventListener('click', function(e) {
            if (e.target === modal) {
              closeDefaultViewModal();
            }
          });
        }
      });

      // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          if (document.getElementById('defaultViewModal').style.display === 'flex') {
            closeDefaultViewModal();
          }
        }
      });
    </script>

  </body>
</html>
